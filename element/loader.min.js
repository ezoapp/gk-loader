define(function(){"use strict";function e(e){return e.replace(/<!--[\s\S]*?-->/gm,"").replace(/>\s+</gm,"><")}function t(e){return e.replace(/\s*(\r\n|\n|\r)\s*/gm,"")}function n(e,t,n,r){return t=a(t,e+"/../"),t=t.substr(0,t.length-n.length-1),(r||"")+t}function r(e){return"function registerElement(n,c){"+gk.toString()+"$.gk.registry(n,gk('"+e+"',c));}"}function i(e){return t(e.script)+"define("+JSON.stringify(e.deps)+", function("+e.vars.join()+"){"+e.moduleText+"});"}function gk(e,t){var n=Object.keys(t||{}),r=function(){for(var e=0,r=n.length;r>e;e+=1)this[n[e]]=t[n[e]]};return{template:e,script:r}}function u(e,t){var r=function(e,n){t.deps.push(e),n&&t.vars.push(n)};e.each(function(e,i){var u=i.getAttribute("path"),c=i.getAttribute("src"),l=i.getAttribute("var");u?r(u,l):c?(c=n(t.moduleId,c,"js"),r(c,l)):t.script+=i.text})}function c(e,t){e.each(function(e,r){var i=r.getAttribute("rel"),u=r.getAttribute("href");u&&("import"===i?t.deps.push(n(t.moduleId,u,"html","@html!")):"stylesheet"===i&&t.deps.push(n(t.moduleId,u,"css","@css!")))})}function l(n,r){var i;n.length&&(n=$("<div>"+n[0].innerHTML+"</div>"),i=n.children("link"),c(i,r),i.remove(),r.template=e(t(n[0].innerHTML)))}function s(e,t){t.moduleText=r(t.template)+(e.length?e[0].text:"")}var o=".html",d=registryGK.urllib,m=d.normalize,a=d.absolute;return{load:function(e,t,n){t(["@text!"+e+o],function(t){var r=$("<div>"+t+"</div>"),o=r.children("script"),d=r.children("link"),m=r.children("element"),a=m.children("template"),p=m.children("script"),f={deps:["require","exports","module"],names:["require","exports","module"],moduleId:e,template:"",moduleText:"",script:""};u(o,f),c(d,f),l(a,f),s(p,f),n.fromText(i(f))})},normalize:m}});