define(["module"],function(e){"use strict";function t(){return window.DOMParser?new DOMParser:void 0}function r(e){if(m)return m.parseFromString("<body>"+e+"</body>","text/html").querySelector("body");var t=document.createElement("div");return t.style.display="none",document.body.appendChild(t),t.innerHTML=e.replace(s,"<$1"+f),t}function n(e){m||document.body.removeChild(e)}function i(e,t){e.each(function(e,r){var n=r.getAttribute("href");n&&t.deps.push(b(n,t.moduleId+"/../")),r.parentNode.removeChild(r)})}function o(e,t){var r,n=[],i={},o={context:"gk"};if(e.each(function(e,r){var i=r.getAttribute("src");i?n.push(b(i,t.moduleId+"/../")):t.script+=E(r).text()}),r=n.length,r&&(t.deps.push(n[r-1]),r>1)){for(var u=r-1;u>0;u-=1)i[n[u]]=[n[u-1]];o.shim=i,t.script="requirejs.config("+JSON.stringify(o)+");"+t.script}}function u(e,t){var r=E("<div>"+e.html()+"</div>");i(r.find("link"),t),t.template=y(x(r.html())),e.html(r.html())}function l(e,t){t.moduleText=I.requireVariables(t.deps)+";"+I.registerElement(t.template)+(e.length?e.text():"")}function c(e){var t="+(function(){"+I.moduleInfo(e.moduleId)+";"+x(e.script)+";define(function("+e.vars.join()+"){"+e.moduleText+"})}());";return t=t.replace(p,"script")}function d(e,t){var d=r(e),a=E(d),m=a.children(f),s=a.find("link"),p=a.children("element"),g=p.children("template"),h=p.children(f);return i(s,t),o(m,t),u(g,t),l(h,t),n(d),c(t)}var a=".html",m=t(),s=/<(\/|)script/g,f=m?"script":"gk__script__tag",p=new RegExp(f,"g"),g=e.config(),h=g.lib,v=h.normalize,b=h.loadUrl,y=h.trimHtml,x=h.trimNewline,k=h.each,E=h.$,q=E.gk;q.createTag(["element","template",f]);var I={requireVariables:function(e){var t=[];return k(e,function(e){t.push('require("'+e+'")')}),t.join(";")},registerElement:function(e){return"function registerElement(n,c){$.gk.registerElement(n,'"+e+"',c)}"},moduleInfo:function(e){return"var module="+JSON.stringify({id:e})}};return q.registerElement=function(e,t,r){q.registry(e,{template:t,script:function(){for(var e=Object.keys(r||{}),t=0,n=e.length;n>t;t+=1)this[e[t]]=r[e[t]]}})},{load:function(e,t,r){t(["@text!"+e+a],function(t){var n={deps:[],vars:["require","exports","module"],moduleId:e,template:"",moduleText:"",script:""};r.fromText(d(t,n))})},normalize:v,pluginBuilder:"./builder"}});