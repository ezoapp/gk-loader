define(function(){"use strict";function keys(){var t=Object.keys||function(t){var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(n);return e};return t.apply(null,arguments)}function t(t,e){if(t)for(var n=0,r=t.length;r>n&&(!t[n]||!e(t[n],n,t));n+=1);}function e(t){return t.replace(/<!--[\s\S]*?-->/gm,"").replace(/>\s+</gm,"><")}function n(t){return t.replace(/\s*(\r\n|\n|\r)\s*/gm,"")}function r(t,e,n,r){return e=h(e,t+"/../"),e=e.substr(0,e.length-n.length-1),(r||"")+e}function i(t){return"function registerElement(n,c){"+keys.toString()+gk.toString()+"$.gk.registry(n,gk('"+t+"',c));}"}function u(t){return"requirejs.config("+JSON.stringify({context:"gk",shim:t})+");"}function c(t){return n((keys(t.shim).length?u(t.shim):"")+t.script)+"define("+JSON.stringify(t.deps)+", function("+t.names.join()+"){"+t.moduleText+"});"}function gk(t,e){var n=keys(e||{}),r=function(){for(var t=0,r=n.length;r>t;t+=1)this[n[t]]=e[n[t]]};return{template:t,script:r}}function s(e,n){var i={},u={},c=function(t,e,r){n.deps.push(r),t&&(n.names.push(t),u[t]=r),e&&(i[r]=e.split(/[\s,]+/))};e.each(function(t,e){var i=e.getAttribute("id"),u=e.getAttribute("src"),s=e.getAttribute("name"),o=e.getAttribute("depends");i?c(s,o,i):u?(u=r(n.moduleId,u,"js"),c(s,o,u)):n.script+=e.text}),t(keys(i),function(e){t(i[e],function(n,r){t(keys(u),function(t){t===n&&(i[e][r]=u[t])})})}),n.shim=i}function o(t,e){t.each(function(t,n){var i=n.getAttribute("href");i&&e.deps.push(r(e.moduleId,i,"html","@html!"))})}function l(t,i){var u;t.length&&(t=$("<div>"+t[0].innerHTML+"</div>"),u=t.children("link"),u.each(function(t,e){var n=e.getAttribute("href");n&&i.deps.push(r(i.moduleId,n,"css","@css!"))}),u.remove(),i.template=e(n(t[0].innerHTML)))}function f(t,e){e.moduleText=i(e.template)+(t.length?t[0].text:"")}var m=".html",a=registryGK.urllib,d=a.normalize,h=a.absolute;return{load:function(t,e,n){e(["@text!"+t+m],function(e){var r=$("<div>"+e+"</div>"),i=r.children("script"),u=r.children("link"),m=r.children("element"),a=m.children("template"),d=m.children("script"),h={deps:["require","exports","module"],shim:{},names:["require","exports","module"],moduleId:t,template:"",moduleText:"",script:""};s(i,h),o(u,h),l(a,h),f(d,h),n.fromText(c(h))})},normalize:d}});