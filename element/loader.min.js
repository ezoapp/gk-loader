define(function(){"use strict";function e(e){return e.replace(/<!--[\s\S]*?-->/gm,"").replace(/>\s+</gm,"><")}function t(e){return e.replace(/\s*(\r\n|\n|\r)\s*/gm,"")}function n(e,t,n,r){return t=p(t,e+"/../"),t=t.substr(0,t.length-n.length-1),(r||"")+t}function r(e){return"function registerElement(n,c){$.gk.registerElement(n,'"+e+"',c)}"}function i(e){return t(e.script)+"define("+JSON.stringify(e.deps)+", function("+e.vars.join()+"){"+e.moduleText+"});"}function u(e,t){var r=function(e,n){t.deps.push(e),n&&t.vars.push(n)};e.each(function(e,i){var u=i.getAttribute("path"),l=i.getAttribute("src"),s=i.getAttribute("var");u?r(u,s):l?(l=n(t.moduleId,l,"js"),r(l,s)):t.script+=i.text})}function l(e,t){e.each(function(e,r){var i=r.getAttribute("rel"),u=r.getAttribute("href");u&&("import"===i?t.deps.push(n(t.moduleId,u,"html","@html!")):"stylesheet"===i&&t.deps.push(n(t.moduleId,u,"css","@css!")))})}function s(n,r){var i;n.length&&(n=$("<div>"+n[0].innerHTML+"</div>"),i=n.children("link"),l(i,r),i.remove(),r.template=e(t(n[0].innerHTML)))}function c(e,t){t.moduleText=r(t.template)+(e.length?e[0].text:"")}var o=".html",d=registryGK.urllib,m=d.normalize,p=d.absolute;return{load:function(e,t,n){t(["@text!"+e+o],function(t){var r=$("<div>"+t+"</div>"),o=r.children("script"),d=r.children("link"),m=r.children("element"),p=m.children("template"),a=m.children("script"),f={deps:["require","exports","module"],vars:["require","exports","module"],moduleId:e,template:"",moduleText:"",script:""};u(o,f),l(d,f),s(p,f),c(a,f),n.fromText(i(f))})},normalize:m}});